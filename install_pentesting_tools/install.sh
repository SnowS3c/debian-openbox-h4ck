#!/bin/bash
# ACTION: Install pentesting tools
# INFO: Install metasploit haha and create some aliases
# DEFAULT: y

# Config variables
base_dir="$(dirname "$(readlink -f "$0")")"

# Check root
[ "$(id -u)" -ne 0 ] && { echo "Must run as root" 1>&2; exit 1; }

# Install packages
echo -e "\e[1mInstalling packages...\e[0m"
apt-get update
apt-get install -y python python3 libssl-dev
apt-get install -y python-pip python3-pip
apt-get install -y ruby ruby-dev
gem install evil-winrm
apt-get install -y dnsutils tcpdump nmap rlwrap whatweb hydra openvpn apache2 ftp cewl cadaver crunch smbclient smbmap masscan sqlmap wfuzz gobuster net-tools

# Metasploit
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
chmod 755 msfinstall
./msfinstall

# Searchsploit
git clone https://github.com/offensive-security/exploitdb.git /opt/exploitdb
ln -sf /opt/exploitdb/searchsploit /usr/local/bin/searchsploit

#JohnTheRipper
git clone "https://github.com/magnumripper/JohnTheRipper.git" /opt/JohnTheRipper
cd /opt/JohnTheRipper/src && ./configure && make
cd "${base_dir}" && cd ..

apt-get install -y netdiscover arp-scan wireshark 


wget -O /usr/bin/ipsweep https://raw.githubusercontent.com/xansx/ipsweep/main/ipsweep.sh
wget -O /usr/bin/whichSystem https://raw.githubusercontent.com/xansx/whichSystem/main/whichSystem.sh
chmod +x /usr/bin/ipsweep /usr/bin/whichSystem

cp -r "${base_dir}"/wordlist/ /usr/share/
[ ! -d "/usr/share/exploit/" ] && mkdir "/usr/share/exploit/"
cp -r "${base_dir}"/windows-binaries /usr/share/exploit/
cp -r "${base_dir}"/linux-tools /usr/share/exploit/

# Config aliases for global (all users)
echo -e "\e[1mSetting configs to all users...\e[0m"
for d in  /etc/skel/  /home/*/ /root/; do
    [ "$(dirname "$d")" = "/home" ] && ! id "$(basename "$d")" &>/dev/null && continue	# Skip dirs that no are homes

	echo 'alias john="/opt/JohnTheRipper/run/john"' >> ~/.bash_aliases

done
